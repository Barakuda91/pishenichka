<!DOCTYPE html>
<html>
<head>
    <title>MY CALCULATOR</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-1BmE4kWBq78iYhFldvKuhfTAU6auU8tT94WrHftjDbrCEXSU1oBoqyl2QvZ6jIW3" crossorigin="anonymous">
    <script src="https://cdn.jsdelivr.net/npm/vue@2.6.14/dist/vue.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-ka7Sk0Gln4gmtz2MlQnikT1wXgYsOg+OMhuP+IlRH9sENBO0LRn5q+8nbTov4+1p" crossorigin="anonymous"></script>
</head>
<body>
    <div class="container" id="app">
        <div class="row">
            <div class="col-sm-2">
                <span class="fw-bold">{{ day }} день {{ year }} г</span> /
            </div>
            <div class="col-sm-3">
                Текущая температура: <span class="fw-bold">{{ temp }} град</span> /
            </div>
            <div class="col-sm-2">
                Баланс: <span class="fw-bold">{{ balance }}</span>
            </div>
            <div class="col-sm-2">
                <button v-on:click="update" class="btn btn-sm btn-outline-primary w-100 mb-1">обновить статус</button>
            </div>
        </div>
        <div class="row">
            <div class="col-sm-3">
                <ul class="list-unstyled mt-3 mb-4">
                    <li>
                        <button
                            v-on:click="additional_tab = additional_tab === 'wealds' ? null : 'wealds'"
                            v-bind:class = "additional_tab === 'wealds' ? 'btn-primary' : 'btn-outline-primary'"
                            class="btn btn-sm w-100 mb-1"
                        >мои поля</button>
                    </li>
                    <li>
                        <button
                                v-on:click="additional_tab = additional_tab === 'warehouse' ? null : 'warehouse'"
                                v-bind:class = "additional_tab === 'warehouse' ? 'btn-primary' : 'btn-outline-primary'"
                                class="btn btn-sm btn-outline-primary w-100 mb-1"
                        >склад</button>
                    </li>
                    <li>
                        <button
                                v-on:click="additional_tab = additional_tab === 'garage' ? null : 'garage'"
                                v-bind:class = "additional_tab === 'garage' ? 'btn-primary' : 'btn-outline-primary'"
                                class="btn btn-sm btn-outline-primary w-100 mb-1"
                        >гараж</button>
                    </li>
                    <li>
                        <button
                                v-on:click="additional_tab = additional_tab === 'shop' ? null : 'shop'"
                                v-bind:class = "additional_tab === 'shop' ? 'btn-primary' : 'btn-outline-primary'"
                                class="btn btn-sm btn-outline-primary w-100 mb-1"
                        >магазин</button>
                    </li>
                </ul>
            </div>
            <div class="col-sm-6">
                <div v-show="additional_tab === 'warehouse'">
                </div>
                <div v-show="additional_tab === 'garage'">
                </div>
                <div v-show="additional_tab === 'shop'">
                    <ul class="list-unstyled mt-3 mb-4">
                        <li>
                            <button
                                class="btn btn-sm btn-outline-secondary w-100 mb-1"
                            >семена</button>
                        </li><li>
                            <button
                                class="btn btn-sm btn-outline-secondary w-100 mb-1"
                            >поля</button>
                        </li><li>
                            <button
                                class="btn btn-sm btn-outline-secondary w-100 mb-1"
                            >техника</button>
                        </li>
                    </ul>
                </div>
                <div v-show="additional_tab === 'wealds'">
                    <ul class="list-unstyled mt-3 mb-4">
                        <li>
                            Ваших полей: <span class="fw-bold">0</span>
                        </li>
                        <li>
                            Засеяно: <span class="fw-bold"> {{ this.plant.name }}</span>
                        </li>
                        <li>
                            Состояние роста: <span class="fw-bold">{{ this.plant.currentHarvest && this.plant.currentHarvest.toFixed(0)  }}</span>
                        </li>
                        <li>
                            Урожая: <span class="fw-bold">{{ this.plant.currentState && this.plant.currentState.toFixed(0) }}</span>
                        </li>
                        <li>
                            Урожая в силосах: <span class="fw-bold">0</span>
                        </li>
                    </ul>
                </div>
            </div>
            <div class="col-sm-3">
            </div>
        </div>
    </div>
</body>
</html>
<script>
    async function postData(url = '', data = {}) {
        // Default options are marked with *
        const response = await fetch(url, {
            method: 'POST', // *GET, POST, PUT, DELETE, etc.
            mode: 'cors', // no-cors, *cors, same-origin
            cache: 'no-cache', // *default, no-cache, reload, force-cache, only-if-cached
            credentials: 'same-origin', // include, *same-origin, omit
            headers: {
                'Content-Type': 'application/json'
                // 'Content-Type': 'application/x-www-form-urlencoded',
            },
            redirect: 'follow', // manual, *follow, error
            referrerPolicy: 'no-referrer', // no-referrer, *client
            body: JSON.stringify(data) // body data type must match "Content-Type" header
        });
        return await response.json(); // parses JSON response into native JavaScript objects
    }
    async function update() {
        const data = await postData('/get_update');
        console.log('data', data);
        this.day = data.currentDay;
        this.year = data.currentYear;
        this.temp = data.temp;
        this.balance = data.balance;
        this.plant = data.plants[0];
    }
    new Vue({
        el: '#app',
        data: {
            additional_tab: null,
            day: null,
            year: null,
            temp: null,
            balance: 0,
            plant: {}
        },
        beforeMount(){
            this.update()
        },
        methods: {
            update,
            update1: function () {
                this.message = `Updated at ${Date.now()}`
            },
            update2: function () {
                this.message = `Updated at ${Date.now()}`
            },
            update3: function () {
                this.message = `Updated at ${Date.now()}`
            },
            update4: function () {
                this.message = `Updated at ${Date.now()}`
            },
        }
    });
</script>

